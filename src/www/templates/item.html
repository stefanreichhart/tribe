<form name="form" ng-controller="ItemController" ng-submit="form.$valid && submit()" ng-cloak class="edit">
	
	<h2 class="row-fluid" >
		<img class="item-poster" ng-src="{{item.poster}}">
		<label for="item.firstname" class="hidden">Firstname</label>
		<input name="item.firstname" type="text" class="input-text" ng-model="item.firstname" placeholder="Firstname" title="Fistname" required />
		<label for="item.lastname" class="hidden">Lastname</label>
		<input name="item.lastname" type="text" class="input-text nofloat" ng-model="item.lastname" placeholder="Lastname" title="Lastname" required />
		<label for="item.position" class="hidden">Position</label>
		<input name="item.position" type="text" class="input-text" ng-model="item.position" placeholder="Position" title="Position" required />
	</h2>

	<div class="row-fluid" >
		<h3>Addresses</h3>
		<ul class="item-entries">
			<li ng-repeat="each in item.addresses" ng-controller="KeyValueAutocompleterController" class="item-entry" >
				<ng-form name="addressForm">
					<div class="item-key" ng-include="'/templates/type.html'" ng-controller="TypeController" ></div>
					<address class="item-value">
						<div>
							<label for="street" class="hidden">Street</label>
							<input name="street" type="text" class="input-text item-street" ng-model="each.street" placeholder="Street" required />
						</div>
						<div>
								<label for="zip" class="hidden">Zip</label>
								<input name="zip" type="hidden" ng-model="each.zip" />
								<md-autocomplete md-selected-item="each.zip" md-search-text="searchTextZip" md-items="zip in getAllSuggestionsWithSearch('zip', searchTextZip, 10) | filter:searchTextZip" md-item-text="zip" md-require-match="false" md-autoselect="true" md-min-length="0" placeholder="Zip-Code" required>
									<span md-highlight-text="searchTextZip">{{zip}}</span>
								</md-autocomplete>
								<label for="city" class="hidden">City</label>
								<input name="city" type="hidden" ng-model="each.city" />
								<md-autocomplete md-selected-item="each.city" md-search-text="searchTextCity" md-items="city in getAllSuggestionsWithSearch('city', searchTextCity, 10) | filter:searchTextCity" md-item-text="city" md-require-match="false" md-autoselect="true" md-min-length="0" placeholder="City" required>
									<span md-highlight-text="searchTextCity">{{city}}</span>
								</md-autocomplete>
						</div>
						<div>
								<label for="country" class="hidden">Country</label>
								<input name="country" type="hidden" ng-model="each.country" />
								<md-autocomplete md-selected-item="each.country" md-search-text="searchTextCountry" md-items="country in getAllSuggestionsWithSearch('country', searchTextCountry, 10) | filter:searchTextCountry" md-item-text="country" md-require-match="false" md-autoselect="true" md-min-length="0" placeholder="Country" required>
									<span md-highlight-text="searchTextCountry">{{country}}</span>
								</md-autocomplete>
						</div>
						<div>
							<div ng-if="googleMap" ng-show="addressForm.street.$valid && addressForm.zip.$valid && addressForm.city.$valid">
								<label for="map">Map</label>
								<input name="map" type="checkbox" ng-model="each.map" onclick="Tribe.lazyInitGoogleMap(jQuery(this));" />
							</div>
							<div class="google-container" ng-if="googleMap && addressForm.street.$valid && addressForm.zip.$valid && addressForm.city.$valid && each.map === true">
								<div class="google-map" data-address="{{each}}" data-editable="true"></div>
								<input type="hidden" ng-model="each.lat"/>
								<input type="hidden" ng-model="each.lng"/>
								<input type="hidden" ng-model="each.zoom"/>
							</div>
						</div>
					</address>
					<a href="" ng-click="removeListEntry(item.addresses, each)" class="item-action item-action-danger glyphicon glyphicon-trash" title="Remove address"><span class="hidden">Remove address</span></a>
					<a href="" ng-if="$last" ng-click="addListEntry(item.addresses, emptyAddress())" class="glyphicon glyphicon-plus item-action" title="Add address"><span class="hidden">Add address</span></a>
				</ng-form>
			</li>
		</ul>
		
	</div>

	<div class="row-fluid" >
		<h3>Phone Numbers</h3>
		<ul class="item-entries">
			<li ng-repeat="each in item.phonenumbers" class="item-entry">
				<div class="item-key" ng-include="'/templates/type.html'" ng-controller="TypeController" ></div>
				<label for="phonenumber.phone" class="hidden">Number</label>
				<input name="phonenumber.phone" type="tel" ng-model="each.phone" class="input-text" placeholder="Phone number" required/>
				<a href="" ng-click="removeListEntry(item.phonenumbers, each)" class="item-action item-action-danger glyphicon glyphicon-trash" title="Remove phone number"><span class="hidden">Remove phone number</span></a>
				<a href="" ng-if="$last" ng-click="addListEntry(item.phonenumbers, emptyPhoneNumber())" class="glyphicon glyphicon-plus item-action" title="Add phone number"><span class="hidden">Add phone number</span></a>
			</li>
		</ul>
	</div>

	<div class="row-fluid" >
		<h3>E-mail</h3>
		<ul class="item-entries">
			<li ng-repeat="each in item.emails" class="item-entry">
				<div class="item-key" ng-include="'/templates/type.html'" ng-controller="TypeController" ></div>
				<label for="email.email" class="hidden">E-Mail</label>
				<input name="email.email" type="email" ng-model="each.email" class="input-text" placeholder="E-mail address" required/>
				<a href="" ng-click="removeListEntry(item.emails, each)" class="item-action item-action-danger glyphicon glyphicon-trash" title="Remove E-mail address"><span class="hidden">Remove E-mail address</span></a>
				<a href="" ng-if="$last" ng-click="addListEntry(item.emails, emptyEmail())" class="glyphicon glyphicon-plus item-action" title="Add E-mail address"><span class="hidden">Add E-mail address</span></a>
			</li>
		</ul>
		
	</div>

	<div class="row-fluid" >
		<h3>Various</h3>
		<div >
			<span class="item-key">Birthday</span>
			<div class="item-value">
				<md-datepicker ng-model="item.birthday" md-placeholder="{{today()}}" placeholder="Birthday"></md-datepicker>
			</div>
		</div>
	</div>

	<div class="row-fluid" >
		<label for="item.description"><h3>Description</h3></label>
		<textarea name="item.description" type="text" class="area-text" ng-model="item.description" placeholder="Description"/>
	</div>

	<div class="row-fluid" >
		<h3>Groups</h3>
		<ul class="item-entries">
			<li ng-repeat="group in getGroups(item)" class="item-entry">
				<span>{{group.name}}</span>
				<a href="" ng-click="removeGroup(item.groups, group)" class="item-action item-action-danger glyphicon glyphicon-trash" title="Remove from group"><span class="hidden">Remove from group</span></a>
			</li>
			<li class="item-entry">
				<md-autocomplete md-selected-item="addableGroup" md-item-text="group.name" md-search-text="searchText" md-items="group in getAddableGroups(item.groups) | filter:{$:searchText}:false" md-item-text="group.name" md-require-match="false" md-no-cache="true" md-autoselect="true" md-min-length="0" placeholder="Add to group">
					<span md-highlight-text="searchText">{{group.name}}</span>
				</md-autocomplete>
				<a href="" ng-click="addGroup(item.groups, addableGroup)" class="glyphicon glyphicon-plus item-action"  title="Add to group"><span class="hidden">Add to group</span></a>
			</li>
		</ul>
	</div>

	<div class="row-fluid controls" >
		<a href="" ng-click="goBack()" class="btn btn-default" ng-show="form.$pristine">{{textBack}}</a>
		<a href="" ng-click="cancelItemConfirmed($event)" class="btn btn-danger" ng-show="form.$dirty">{{textCancel}}</a>
		<input type="submit" class="btn btn-primary" value="{{textSave}}" ng-disabled="form.$invalid || form.$error.$required"/>
	</div>
</form>

<script async defer ng-src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB7a5yoZSk2DHwukVlykFQUHFy1jTKGm7s&callback=Tribe.initGoogleMaps" ng-if="googleMap"></script>